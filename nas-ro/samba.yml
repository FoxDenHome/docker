services:
  samba:
    build: samba
    restart: always
    hostname: nas-ro.foxden.network
    userns_mode: host
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=0
    ports:
      - 137:137
      - 138:138
      - 139:139
      - 445:445
    volumes:
      - ssl:/etc/letsencrypt
      - samba_config:/var/lib/samba
      - /mnt/ephemeral/nas/zhdd/nashome:/home
      - /mnt/ephemeral/nas/zhdd/nas:/mnt/nas
      - /mnt/ephemeral/nas/tmp:/mnt/tmp
    healthcheck:
      test: 'smbstatus -S -f'
      interval: 60s
      timeout: 10s

volumes:
  samba_config: {}
