services:
  prosody:
    build: prosody
    restart: always
    hostname: foxden.network
    environment:
      LOG_LEVEL: info
      DB_DRIVER: SQLite3
      DB_DATABASE: prosody.sqlite
      DOMAIN: foxden.network
      DOMAIN_HTTP_UPLOAD: upload.xmpp.foxden.network
      DOMAIN_MUC: muc.xmpp.foxden.network
      DOMAIN_PROXY: proxy.xmpp.foxden.network
      DOMAIN_PUBSUB: pubsub.xmpp.foxden.network
      PROSODY_ADMINS: doridian@foxden.network
      ALLOW_REGISTRATION: 'true'
      C2S_REQUIRE_ENCRYPTION: 'true'
      S2S_REQUIRE_ENCRYPTION: 'true'
      S2S_SECURE_AUTH: 'true'
      E2E_POLICY_CHAT: 'none'
      E2E_POLICY_MUC: 'none'
      E2E_POLICY_WHITELIST: ''
      SERVER_CONTACT_INFO_ABUSE: doridian@foxden.network
      SERVER_CONTACT_INFO_ADMIN: doridian@foxden.network
      SERVER_CONTACT_INFO_FEEDBACK: doridian@foxden.network
      SERVER_CONTACT_INFO_SALES: doridian@foxden.network
      SERVER_CONTACT_INFO_SECURITY: doridian@foxden.network
      SERVER_CONTACT_INFO_SUPPORT: doridian@foxden.network
      SLIDCORD_SECRET: "${SLIDCORD_SECRET}"
      SLIDGRAM_SECRET: "${SLIDGRAM_SECRET}"
      TZ: America/Los_Angeles
    volumes:
    - prosody_config:/usr/local/etc/prosody
    - prosody_letsencrypt:/etc/letsencrypt
    - prosody_data:/usr/local/var/lib/prosody
  slidcord:
    image: nicocool84/slidcord:master
    restart: always
    hostname: discord.foxden.network
    command:
    - "--server"
    - "foxden.network"
    - "--user-jid-validator"
    - ".*@foxden.network"
    - "--jid"
    - "discord.foxden.network"
    - "--secret"
    - "${SLIDCORD_SECRET}"
    links:
    - prosody:foxden.network
    - prosody:xmppshare.foxden.network
    environment:
      TZ: America/Los_Angeles
    volumes:
    - slidcord_data:/var/lib/slidge
  slidgram:
    image: nicocool84/slidgram:master
    restart: always
    hostname: telegram.foxden.network
    command:
    - "--server"
    - "foxden.network"
    - "--user-jid-validator"
    - ".*@foxden.network"
    - "--jid"
    - "telegram.foxden.network"
    - "--secret"
    - "${SLIDGRAM_SECRET}"
    links:
    - prosody:foxden.network
    - prosody:xmppshare.foxden.network
    environment:
      TZ: America/Los_Angeles
    volumes:
    - slidgram_data:/var/lib/slidge

volumes:
  prosody_config: {}
  prosody_letsencrypt: {}
  prosody_data: {}

  slidcord_data: {}
  slidgram_data: {}
