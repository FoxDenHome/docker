---
# This configuration file is documented in docs/02-configuration.md.
# You can get all default values with `akvorado orchestrator /dev/null
# --dump --check` or `docker-compose run akvorado-orchestrator
# orchestrator /dev/null --dump --check`.
kafka:
  topic: flows
  version: 3.3.1
  brokers:
    - kafka:9092
  topic-configuration:
    num-partitions: 8
    replication-factor: 1
    config-entries:
      # The retention policy in Kafka is mainly here to keep a buffer
      # for ClickHouse.
      segment.bytes: 1073741824
      retention.ms: 86400000 # 1 day
      cleanup.policy: delete
      compression.type: producer

clickhouse:
  orchestrator-url: http://akvorado-orchestrator:8080
  kafka:
    consumers: 4
  servers:
    - clickhouse:9000
  asns:
  networks:
    10.1.0.0/16:
      name: mgmt
      role: lan
  network-sources:


inlet:
  kafka:
    compression-codec: zstd
  geoip:
    optional: true
    # When running on Docker, these paths are inside the container.
    # Check docker-compose.yml for details.
    asn-database: /usr/share/GeoIP/GeoLite2-ASN.mmdb
    geo-database: /usr/share/GeoIP/GeoLite2-Country.mmdb
  snmp:
    workers: 10
    communities:
      ::/0: public
  flow:
    inputs:
      - type: udp
        decoder: netflow
        listen: 0.0.0.0:2055
        workers: 6
        receive-buffer: 10485760
      - type: udp
        decoder: sflow
        listen: 0.0.0.0:6343
        workers: 6
        receive-buffer: 10485760
  core:
    workers: 6
    default-sampling-rate: 1
    exporter-classifiers:
      # This is an example. This should be customized depending on how
      # your exporters are named.
      - ClassifySiteRegex(Exporter.Name, "^([^-]+)-", "$1")
      - ClassifyRegion("europe")
      - ClassifyRole("edge")
    interface-classifiers:
      # This is an example. This must be customized depending on the
      # descriptions of your interfaces. In the following, we assume
      # external interfaces are named "Transit: Cogent" Or "IX:
      # FranceIX".
      - |
        ClassifyConnectivityRegex(Interface.Description, "^(?i)(transit|pni|ppni|ix):? ", "$1") &&
        ClassifyProviderRegex(Interface.Description, "^\\S+?\\s(\\S+)", "$1") &&
        ClassifyExternal()
      - ClassifyInternal()

console:
  http:
    cache:
      type: redis
      server: redis:6379
  database:
    saved-filters:
      # These are prepopulated filters you can select in a drop-down
      # menu. Users can add more filters interactively.
      - description: "From Netflix"
        content: >-
          InIfBoundary = external AND SrcAS = AS2906
      - description: "From GAFAM"
        content: >-
          InIfBoundary = external AND
          SrcAS IN (AS15169, AS16509, AS32934, AS6185, AS8075)
